name: Auto Bash Handler

on:
  issue_comment:
    types: [created]

permissions:
  issues: write
  contents: write

jobs:
  handle_bash_request:
    runs-on: ubuntu-latest
    if: github.event.issue.pull_request == null &&
        github.event.comment.user.login == 'DisabledAbel'

    steps:
      - name: Check out repository
        uses: actions/checkout@v4

      - name: Detect emoji reaction
        id: emoji
        run: |
          body="${{ github.event.comment.body }}"
          if echo "$body" | grep -q "ğŸ‘"; then
            echo "reaction=up" >> $GITHUB_OUTPUT
          elif echo "$body" | grep -q "ğŸ‘"; then
            echo "reaction=down" >> $GITHUB_OUTPUT
          else
            echo "reaction=none" >> $GITHUB_OUTPUT
          fi

      - name: Add Bash script (ğŸ‘)
        if: steps.emoji.outputs.reaction == 'up'
        run: |
          mkdir -p scripts
          safe_title=$(echo "${{ github.event.issue.title }}" | tr ' ' '_' | tr -cd '[:alnum:]_')
          file_name="scripts/${safe_title}.sh"
          echo "${{ github.event.issue.body }}" > "$file_name"
          echo "âœ… Added $file_name"
          git config user.name "github-actions"
          git config user.email "actions@github.com"
          git add scripts/
          git diff --quiet || git commit -m "Auto-added bash from issue #${{ github.event.issue.number }}"
          git push

      - name: Close the issue (ğŸ‘)
        if: steps.emoji.outputs.reaction == 'up'
        uses: peter-evans/close-issue@v3
        with:
          issue-number: ${{ github.event.issue.number }}
          comment: "âœ… Bash script added and issue closed automatically."

      - name: Reopen the issue (ğŸ‘)
        if: steps.emoji.outputs.reaction == 'down'
        uses: peter-evans/open-issue@v3
        with:
          issue-number: ${{ github.event.issue.number }}
          comment: "ğŸ”„ Reopened for updates â€” please make necessary changes."
