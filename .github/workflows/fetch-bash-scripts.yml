name: üåÄ Fetch Bash Scripts

on:
  schedule:
    - cron: "0 */12 * * *"  # Every 12 hours
  workflow_dispatch:        # Allow manual run

jobs:
  fetch:
    runs-on: ubuntu-latest

    steps:
      - name: üõ†Ô∏è Checkout repo
        uses: actions/checkout@v4

      - name: ‚öôÔ∏è Set up environment
        run: |
          mkdir -p scripts
          echo "Existing scripts:"
          ls scripts || true

      - name: üîç Search and fetch Bash repos
        run: |
          echo "üîç Searching for top Bash repositories..."
          curl -s "https://api.github.com/search/repositories?q=language:bash+stars:>10&sort=stars&order=desc&per_page=5" > repos.json

          repos=$(jq -r '.items[].full_name' repos.json)
          echo "üì¶ Found repos:"
          echo "$repos"

          for repo in $repos; do
            echo "‚û°Ô∏è Checking $repo ..."
            rm -rf temp-repo
            git clone --depth=1 "https://github.com/$repo.git" temp-repo || continue

            find temp-repo -type f -name "*.sh" | while read -r script; do
              filename=$(basename "$script")
              newname="scripts/${repo//\//_}-${filename}"

              # Skip if file already exists
              if [ -f "$newname" ]; then
                echo "‚ö†Ô∏è Skipping existing $newname"
                continue
              fi

              cp "$script" "$newname"
              echo "‚úÖ Added $newname ($(wc -c < "$newname") bytes)"
            done
          done

      - name: üßπ Clean up temp folder
        run: rm -rf temp-repo repos.json || true

      - name: üíæ Commit and push changes
        run: |
          git config user.name "github-actions"
          git config user.email "actions@github.com"
          git add scripts/
          git diff --cached --quiet || git commit -m "Auto fetch new bash scripts"
          git push
